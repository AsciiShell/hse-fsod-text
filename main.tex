%!TEX TS-program = xelatex
\documentclass[a4paper,14pt]{article}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}

\input{data/preambular.tex}
\usepackage[fixlanguage]{babelbib}
\usepackage{lastpage}
\begin{document}

    \input{data/title.tex}

    \section*{\normalsize \hfill Аннотация \hfill}

    ...

    \sloppy
    \newpage

    \section*{\normalsize \hfill Abstract \hfill}

    ...

    \newpage

    \tableofcontents
    \pagebreak

    \section*{Введение}
    \addcontentsline{toc}{section}{\protect\numberline{}Введение}


    \newpage


    \section{Обзор литературы}

    \subsection{Основные понятия}

    Задача детекции объектов (object detection) на изображении включает в себя несколько подзадач:
    \begin{enumerate}
        [1)]
        \itemsep0em
        \item определение прямоугольной области, ограничивающей объект (bounding box, bbox);
        \item классификация выделенной области;
    \end{enumerate}
    В результате работы модели, решающей задачу поиска объектов, получаются области или регионы изображения (object proposals) в которых может находиться объект, а также определена вероятность принадлежности этого объекта к определенному классу.

    Дополнительно могут решаться задачи нахождения ключевых точек объекта и сегментации - отделения объекта от фона, нахождение маски объекта.

    Наиболее популярные датасеты для обучения модели детекции объектов: MS~COCO~\cite{COCO}, LVIS~\cite{LVIS}, Objects365~\cite{Objects365}.
    Датасет LVIS содержит 164 тысячи изображений для решения задачи сегментации. Разработчиками предоставлена высококачественная разметка для более 1200 различных категорий.
    
    Эмбеддинг (embedding) -- скрытое векторное представление объекта (текстовых, графические, табличных и аудио данных) фиксированной размерности.

    Карта признаков (feature map) -- векторное представление изображения нефиксированной размерности, где элемент карты содержит информацию о некоторой области изображения.

    NMS (non-maximum suppression)~\cite{neubeck2006efficient} -- алгоритм выделения регионов изображения с максимумом уверенности в классификации.
    В данном алгоритме объединяются регионы, отношение площади пересечения к объединению (IoU, Intersection over Union) которых больше заданного порога.
    Алгоритм позволяет получить из большого числа похожих или маловероятных регионов изображений один или несколько малопересекающихся регионов.

    Mask R-CNN (Regions With CNNs)~\cite{MaskRCNN} -- двухэтапная нейронная сеть, позволяющая решать задачи детекции объектов и сегментации. В основе сети лежит сверточная нейронная сеть FCN (Fully Convolutional Network), состоящая только из сверточных (convolution) слоев и слоев подвыборки (pooling). Первый модуль RPN (Region Proposal Network) позволяет выделить регионы изображения по карте признаков сверточной нейронной сети. Вторым этапом происходит предсказание bounding box, класса и маски объекта для каждого региона.

    YOLO (You Only Look Once)~\cite{redmon2016you} -- семейство архитектур моделей, позволяющее ускорить решение задачи детекции объектов и получать результаты в режиме реального времени.
    Это одноэтапная нейронная сеть, не использующая модуль для выделения регионов изображения.
    В модели сначала получают карты признаков для изображения с помощью сверточных слоев, далее для каждого элемента карты решаются задачи определения класса объекта и его размеров, центр которого находится в данном элементе карты.
    В модели используется 3 карты признаков различных размеров: каждая последующая получается применением набора сверток к предыдущей.
    Такой подход используется для нахождения объектов разных размеров -- маленьких, средних и больших.
    Модели YOLO обучены на датасете COCO, содержащем 80 категорий.

    CLIP (Contrastive Language–Image Pre-training)~\cite{CLIP} -- модель, позволяющая переводить текстовые описания и изображения в единое векторное пространство.
    CLIP предоставляет возможность решать задачу детекции объектов без дообучения для произвольных классов.
    В основе модели лежат Text Encoder и Image Encoder для преобразования текста и изображения в векторные представления, косинусное расстояние между которыми максимизируется для релевантных пар текста и изображения и минимизируется для нерелевантных.

    \subsection{Детекция объектов по произвольному текстовому запросу}

    В статье~\cite{ViLD} предложен метод ViLD - Vision and Language knowledge Distillation, позволяющий находить объекты с произвольным текстовым описанием.
    На этапе обучения рассчитываются текстовые эмбеддинги описаний категорий и эмбеддинги регионов изображения с использованием предобученной модели (модель-учитель).
    Обучается модель детекции объектов Mask R-CNN (модель-ученик), которая дополнительно максимизирует расстояние между эмбеддингом региона предобученной модели-учителя и эмбеддингами региона модели-ученика.
    Таким образом, происходит извлечение знаний (дистилляция) из модели-учителя.
    Во время применения модели-ученика предобученная модель-учитель используется только для получения текстовых эмбеддингов, а эмбеддинги для регионов получается из модели-ученика.
    Итоговые регионы получаются в результате ранжирования оценок, полученных как скалярное произведение текстового эмбеддинга модели-учителя и эмбеддинга региона модели-ученика.

    В качестве модели-учителя в статье используется модель CLIP.
    Модель обучена на датасете LVIS. В работе отмечается, что модель может применяться и к другим датасетам (COCO, Objects365) без дообучения.

    Преимуществом описанного подхода является использование одной модели как для выделения регионов, так и для получения их эмбеддингов, что ускоряет время применения, однако точность при таком подходе понижается.

    Полученную модель предлагается использовать следующим образом: для изображения подавать набор текстовых описаний и отбирать заданное количество регионов с минимальным скалярным произведением.

    К недостаткам предлагаемого подхода можно отнести поиск текстовых описаний только на одном изображении, то есть при отсутствии объектов, релевантных набору текстовых описаний, алгоритм выведет требуемое количество регионов (для нерелевантных текстовых описаний скалярное произведение также может быть высокое).

    \subsection{Инженерный подход к разметке изображений}

    В решении~\cite{AnnoMage} реализован подход для полу-автоматизированной разметки датасетов изображений. В предложенном приложении автоматически размечаются области, соответствующие выбранным классам датасета COCO, полученные с помощью загруженной модели.

    В отличие от решения ~\cite{AnnoMage} в курсовой работе предлагается подход с дообучением модели на новой разметке и применением модели для произвольных текстовых запросов.

    \subsection{Цель и задачи исследования}
    
    Предлагаемый подход можно применять также для отбора наиболее релевантных изображений из пользовательского датасета.

    Задачи:
    \begin{enumerate}
        [1)]
        \itemsep0em
        \item йцу

    \end{enumerate}

    \subsection{Выводы к главе \thesection}
    \begin{enumerate}
        [1)]
        \itemsep0em
        \item йцу
    \end{enumerate}

    \newpage


    \section{Теоретическая часть}
    
    \subsection{Приблизительный поиск ближайших соседей}
    
    \subsection{Подход к детекции объектов по произвольному текстовому запросу}
    
    Целью данного подхода является выделение заданного количества наиболее релевантных изображений по произвольному текстовому описанию. Подход реализуется в несколько этапов:
     \begin{enumerate}
    	[1)]
    	\itemsep0em
    	\item получение регионов для всего доступного множества изображений;
    	\item вычисление векторного представления регионов и текстового запроса;
    	\item поиск ближайших регионов к текстовому запросу.
    \end{enumerate}
    
    При проведении эксперимента для оценки качества предлагаемого подхода используются изображения датасета LVIS. 
    
    В качестве модели для выделения регионов использовалась одноэтапная модель YOLOv5. Исходная модель YOLOv5 была модифицирована таким образом, чтобы в результате применения модели получалось как можно больше регионов. Для этого уменьшался порог уверенности модели в классификации и для объединения похожих регионов использовался модифицированный алгоритм NMS. 
    
    В измененном алгоритме NMS не учитывается предсказанный класс объекта - это сделано для того, чтобы получать регионы  для объектов, на которые модель не была обучена. Чтобы избавиться от дублированных регионов к ограничивающей области была применена кластеризация методом k-средних с заданным максимальным количеством классов, после чего к областям одного класса применялся классический алгоритм NMS. 
    
    %TODO Картинка
    
    При проведении эксперимента количество кластеров для метода k-средних определялось по следующей формуле: $\max(\min(30, \left[\frac{m}{2}\right]), 1),$ где $m$ - количество найденных на изображении регионов. Для проведения расчетов использовались также следующие гиперпараметры:
    \begin{center}
    	\begin{tabular}{| l | l |}
    		\hline
    		Порог уверенности модели в классификации & 0.01\\ \hline
    		Пороговое значение IoU & 0.45 \\ \hline
    		Максимальное количество регионов в NMS  & 10\\
    		\hline
    	\end{tabular}
    \end{center}

	Далее для каждого выделенного региона изображения применялась модель CLIP. Текстовый запрос также переводился в векторное пространство с помощью этой модели. Для тестирования подхода в качестве текстовых запросов использовались определения категорий датасета LVIS.
	
	С помощью приблизительного поиска ближайших соседей, а также полным перебором по максимизации косинусного расстояния для сравнения результатов осуществлялся поиск заданного количества ближайших векторов регионов к вектору текстового запроса (определению категории).
	
	%В результате применения подхода исследовались следующие метрики
    
    Таким образом, для повышения точности среди выбранных изображений в предлагаемом подходе последовательно используются 2 модели.
    
    В качестве эксперимента также было проведено сравнение качества модели ViLD при использовании только результатов выделения регионов, а также с использованием эмбеддинга региона из модели ViLD. В последнем случае модель CLIP не применялась к найденным регионам.
    %TODO провести такой эксперимент
    
    \subsection{Выводы к главе \thesection}
    \begin{enumerate}
        [1)]
        \itemsep0em
        \item йцу
    \end{enumerate}

    \newpage


    \section{Практическая часть}

    \subsection{Выводы к главе \thesection}



    \newpage


    \section{Заключение}

    В работе изучена...

    \newpage
    \renewcommand{\refname}{{\normalsize \hfill Список использованных источников \hfill}}
%    \bibliographystyle{unsrt}
    \selectbiblanguage{russian}
    \bibliographystyle{BibTeX-Styles/ugost2008mod}
    \bibliography{main}
    \newpage

\end{document}